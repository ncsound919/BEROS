# Makefile for AetherDesk Platform
# Generated by AutoCoder Marathon Build
#
# Template variables:
#   - project_name: str (default "aetherdesk")

.PHONY: help install test lint format build up down logs clean restart

help:
	@echo "AetherDesk - Available commands:"
	@echo "  make install     - Install all dependencies (backend + frontend)"
	@echo "  make test        - Run all tests (backend + frontend)"
	@echo "  make lint        - Run linters"
	@echo "  make format      - Format code (black + prettier)"
	@echo "  make build       - Build Docker images"
	@echo "  make up          - Start all services with Docker Compose"
	@echo "  make down        - Stop all services"
	@echo "  make logs        - View Docker logs"
	@echo "  make restart     - Restart all services"
	@echo "  make clean       - Clean build artifacts and caches"

install:
	@echo "Installing backend dependencies..."
	python -m venv venv
	./venv/Scripts/activate && pip install -r requirements.txt
	@echo "Installing frontend dependencies..."
	cd agent-ui && npm install
	@echo "Installation complete!"

test:
	@echo "Running backend tests..."
	./venv/Scripts/activate && python -m pytest apps/api/tests/ -v
	@echo "Running frontend tests..."
	cd agent-ui && npm run test:run
	@echo "All tests complete!"

lint:
	@echo "Linting backend..."
	./venv/Scripts/activate && python -m black apps/api --check
	@echo "Linting frontend..."
	cd agent-ui && npm run lint
	@echo "Linting complete!"

format:
	@echo "Formatting backend code..."
	./venv/Scripts/activate && python -m black apps/api
	@echo "Formatting frontend code..."
	cd agent-ui && npm run format 2>/dev/null || echo "No format script defined"
	@echo "Formatting complete!"

build:
	@echo "Building Docker images..."
	docker-compose build
	@echo "Build complete!"

up:
	@echo "Starting services..."
	docker-compose up -d
	@echo "Services started! Backend: http://localhost:8000 Frontend: http://localhost:5173"

down:
	@echo "Stopping services..."
	docker-compose down
	@echo "Services stopped!"

logs:
	docker-compose logs -f

restart: down up

clean:
	@echo "Cleaning build artifacts..."
	rm -rf agent-ui/dist agent-ui/node_modules/.vite
	rm -rf apps/**/__pycache__ apps/**/*.pyc
	rm -rf .pytest_cache
	rm -rf htmlcov .coverage
	@echo "Clean complete!"
