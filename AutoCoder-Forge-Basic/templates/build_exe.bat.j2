@echo off
REM Build script for Overlay Cheetah executable
REM Generated by AutoCoder
REM
REM Template variables:
REM   - spec_file: str (default "overlay_cheetah.spec")
REM   - output_name: str (default "OverlayCheetah.exe")

echo.
echo ============================================
echo  Building Overlay Cheetah Executable
echo ============================================
echo.

REM Check if PyInstaller is installed
python -c "import PyInstaller" 2>nul
if errorlevel 1 (
    echo [ERROR] PyInstaller is not installed
    echo [INFO] Installing PyInstaller...
    python -m pip install pyinstaller
    if errorlevel 1 (
        echo [ERROR] Failed to install PyInstaller
        pause
        exit /b 1
    )
)

echo [OK] PyInstaller is available
echo.

REM Check if spec file exists
if not exist "{{ spec_file }}" (
    echo [ERROR] Spec file not found: {{ spec_file }}
    echo [INFO] Please ensure you're running this from the Overlay_Cheetah directory
    pause
    exit /b 1
)

echo [INFO] Using spec file: {{ spec_file }}
echo.

REM Clean previous builds
if exist "build" (
    echo [CLEAN] Removing old build directory...
    rmdir /s /q build
)

if exist "dist" (
    echo [CLEAN] Removing old dist directory...
    rmdir /s /q dist
)

echo.
echo [BUILD] Running PyInstaller...
echo.

REM Run PyInstaller with the spec file
python -m PyInstaller --clean --noconfirm {{ spec_file }}

if errorlevel 1 (
    echo.
    echo [ERROR] Build failed!
    echo [INFO] Check the output above for errors
    pause
    exit /b 1
)

echo.
echo ============================================
echo  Build Complete!
echo ============================================
echo.

REM Check if exe was created
if exist "dist\{{ output_name }}" (
    echo [SUCCESS] Executable created: dist\{{ output_name }}

    REM Get file size
    for %%A in ("dist\{{ output_name }}") do (
        set size=%%~zA
        set /a sizeKB=!size! / 1024
        set /a sizeMB=!sizeKB! / 1024
        echo [INFO] File size: !sizeMB! MB ^(!sizeKB! KB^)
    )

    echo.
    echo [INFO] You can now distribute dist\{{ output_name }}
    echo [INFO] Users can run it without Python installed
    echo.
    echo Next steps:
    echo   1. Test the exe: dist\{{ output_name }}
    echo   2. Create a zip with: {{ output_name }} + EXE_README.md
    echo   3. Distribute to users
    echo.
) else (
    echo [ERROR] Executable not found in dist directory
    echo [INFO] Build may have failed silently
    pause
    exit /b 1
)

echo ============================================
echo.

pause
