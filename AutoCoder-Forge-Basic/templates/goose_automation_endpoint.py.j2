project 1\AutoCoder-Forge-Basic\templates\goose_automation_endpoint.py.j2
"""
Goose Automation API Router for FinAI Hub
Generated by AutoCoder

Template variables:
  - endpoint_prefix: str (API prefix)
  - mcp_server_url: str (MCP server URL)
"""

from fastapi import APIRouter, HTTPException
from pydantic import BaseModel
from typing import List, Dict, Any
import requests

router = APIRouter(prefix="{{ endpoint_prefix }}", tags=["goose"])

class AutomationRequest(BaseModel):
    action: str
    parameters: Dict[str, Any] = {}

class AutomationResponse(BaseModel):
    result: Dict[str, Any]
    status: str

@router.post("/automate", response_model=AutomationResponse)
async def run_automation(request: AutomationRequest):
    try:
        # Forward to MCP server
        payload = {
            "action": request.action,
            "parameters": request.parameters
        }
        response = requests.post(f"{{ mcp_server_url }}/automate", json=payload, timeout=30)
        response.raise_for_status()

        data = response.json()
        return AutomationResponse(result=data, status="success")

    except requests.RequestException as e:
        raise HTTPException(status_code=503, detail=f"Goose MCP unavailable: {str(e)}")
    except Exception as e:
        raise HTTPException(status_code=500, detail=f"Automation failed: {str(e)}")

@router.get("/status")
async def get_status():
    try:
        response = requests.get(f"{{ mcp_server_url }}/status", timeout=5)
        return {"available": response.status_code == 200}
    except:
        return {"available": False}
